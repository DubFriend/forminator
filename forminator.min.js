// forminator version 0.0.0
// https://github.com/DubFriend/forminator
// (MIT) 12-02-2014
// Brian Detering <BDeterin@gmail.com> (http://www.briandetering.net/)
!function(){"use strict";!function(a){a.fn.ajaxfileupload=function(b){var c={params:{},action:"",onStart:function(){console.log("starting upload"),console.log(this)},onComplete:function(a){console.log("got response: "),console.log(a),console.log(this)},onCancel:function(){console.log("cancelling: "),console.log(this)},validate_extensions:!0,valid_extensions:["gif","png","jpg","jpeg"],submit_button:null},d=!1;return b&&a.extend(c,b),this.each(function(){var b=a(this);if(b.data("ajaxUploader-setup")!==!0){b.change(function(){d=!1,null==c.submit_button&&e()}),null==c.submit_button||c.submit_button.click(function(a){a.preventDefault(),d||e()});var e=function(){if(""==b.val())return c.onCancel.apply(b,[c.params]);var e=b.val().split(".").pop().toLowerCase();if(!0===c.validate_extensions&&-1==a.inArray(e,c.valid_extensions))c.onComplete.apply(b,[{status:!1,message:"The select file type is invalid. File must be "+c.valid_extensions.join(", ")+"."},c.params]);else{d=!0,g(b);var f=c.onStart.apply(b,[c.params]);f!==!1&&b.parent("form").submit(function(a){a.stopPropagation()}).submit()}};b.data("ajaxUploader-setup",!0);var f=function(a,b){var e,f=a.contentWindow.document.body.innerHTML;try{e=JSON.parse(f)}catch(g){e=f}b.siblings().remove(),b.unwrap(),d=!1,c.onComplete.apply(b,[e,c.params])},g=function(b){var d="ajaxUploader-iframe-"+Math.round((new Date).getTime()/1e3);a("body").after('<iframe width="0" height="0" style="display:none;" name="'+d+'" id="'+d+'"/>'),a("#"+d).load(function(){f(this,b)}),b.wrap(function(){return'<form action="'+c.action+'" method="POST" enctype="multipart/form-data" target="'+d+'" />'}).before(function(){var a,b="";for(a in c.params){var d=c.params[a];"function"==typeof d&&(d=d()),b+='<input type="hidden" name="'+a+'" value="'+d+'" />'}return b})}}})}}(jQuery);{var a=function(a){return $.isArray(a)},b=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},c=function(a,b){return $.inArray(b,a)},d=function(a,b){return-1!==c(a,b)},e=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)},f=function(a,b){var c=[];return e(a,function(a,d,e){c.push(b(a,d,e))}),c},g=function(a,b,c){var d={};return e(a,function(a,e,f){e=c?c(e,a):e,d[e]=b(a,e,f)}),d},h=function(b,c,d){return a(b)?f(b,c):g(b,c,d)},i=function(a,b,c){e(a,function(a){a[b].apply(a,c||[])})},j=function(a){return f(a,function(a,b){return b})},k=function(b,c){var d;return a(b)?(d=[],e(b,function(a,b,e){c(a,b,e)&&d.push(a)})):(d={},e(b,function(a,b,e){c(a,b,e)&&(d[b]=a)})),d},l=function(){var a,b={};for(a=0;a<arguments.length;a+=1)e(arguments[a],function(a,c){b[c]=a});return b},m=function(a,b){return k(a,function(a,d){return-1!==c(b,d)})},n=(function(){var a=0;return function(){return a+=1}}(),function(a){a=a||{};var b={};return a.publish=function(a,c){e(b[a],function(a){a(c)})},a.subscribe=function(a,c){b[a]=b[a]||[],b[a].push(c)},a.unsubscribe=function(a){e(b,function(b){var d=c(b,a);-1!==d&&b.splice(d,1)})},a});!function(){var a={},b=function(a){var b,d,e,f="",g="",h=function(){var b=-1!==c(a,"#"),d=-1!==c(a,"?"),e="";return d&&(e=a.split("?")[1]||"",b&&(e=e.split("#")[0]||"")),f=d?a.split("?")[0]||"":b?a.split("#")[0]||"":a,b&&(g=a.split("#")[1]||""),e?e.split("&"):[]},i=h(a),j={};for(e=0;e<i.length;e+=1)b=i[e].split("=")[0],d=i[e].split("=")[1],j[b]=d;return{url:f||"",hash:g||"",parameters:j}},d=function(a){var b=[];return e(a.parameters,function(c,d){b.push(d+"="+a.parameters[d])}),a.url+(b.length>0?"?"+b.join("&"):"")+(a.hash?"#"+a.hash:"")};return a.get=function(a){return b(a).parameters},a.set=function(a,c){var e=b(a);return e.parameters=l(e.parameters,c),d(e)},a}()}"undefined"==typeof console&&(console={},console.warn=function(){});var o=function(a){var b={},c=a.url,d=a.$;return b.input={text:x,textarea:y,select:w,radio:v,checkbox:t,file:u,button:s},b.form=function(a){return a=a||{},B(l({$:d,ajax:p,url:c,inputs:h(z({$:d,factory:b}),function(a){return A({input:a})})},a))},b},p=function(a){$.ajax(a)},q=function(a){var b=n(),c=a.$;return b.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},b.$=function(a){return a?c.find(a):c},b.disable=function(){b.$().prop("disabled",!0),b.publish("isEnabled",!1)},b.enable=function(){b.$().prop("disabled",!1),b.publish("isEnabled",!0)},b},r=function(a,b){var c=q(a,b);return c.get=function(){return c.$().val()},c.set=function(a){var b=c.get();b!==a&&(c.$().val(a),c.publish("change",a))},b.buildSetter=function(a){return function(b){var d=c.get();d!==b&&(a.call(c,b),c.publish("change",b))}},c},s=function(a){var b={},c=r(a,b);return c.getType=function(){return"button"},c},t=function(a){var b={},d=r(a,b);return d.getType=function(){return"checkbox"},d.get=function(){var a=[];return d.$().filter(":checked").each(function(){$(this).is(":checked")&&a.push($(this).val())}),a},d.set=function(a){a=a||[];var b=d.get(),f=!1;b.length===a.length?e(b,function(b){-1===c(a,b)&&(f=!0)}):f=!0,f&&(d.$().each(function(){$(this).prop("checked",!1)}),e(a,function(a){d.$().filter('[value="'+a+'"]').prop("checked",!0)}),d.publish("change",a))},d.$().click(function(){d.publish("change",d.get())}),d},u=function(a){var b={},c=q(a,b);return c.getType=function(){return"file"},c},v=function(a){var b={},c=r(a,b);return c.getType=function(){return"radio"},c.get=function(){return c.$().filter(":checked").val()},c.set=b.buildSetter(function(a){c.$().filter('[value="'+a+'"]').prop("checked",!0)}),c.$().change(function(){c.publish("change",c.get())}),c},w=function(a){var b={},c=r(a,b);return c.getType=function(){return"select"},c.$().change(function(){c.publish("change",c.get())}),c},x=function(a){var b={},c=r(a,b);return c.getType=function(){return"text"},c.$().keyup(function(){c.publish("change",c.get())}),c},y=function(a){var b={},c=r(a,b);return c.getType=function(){return"textarea"},c.get=function(){return c.$().html()},c.set=b.buildSetter(function(a){this.$().html(a)}),c.$().keyup(function(){c.publish("change",c.get())}),c},z=function(a){var b=a.$,d=a.factory,f={},g=function(a,c,e){e=e||f,b.find(c).each(function(){e[$(this).attr("name")]=d.input[a]({$:$(this)})})};g("text",'input[type="text"]'),g("textarea","textarea"),g("select","select"),g("file",'input[type="file"]'),g("button",'input[type="button"], input[type="submit"]');var h=function(a,g){var h=[];b.find(g).each(function(){-1===c(h,$(this).attr("name"))&&h.push($(this).attr("name"))}),e(h,function(c){f[c]=d.input[a]({$:b.find('input[name="'+c+'"]')})})};return h("radio",'input[type="radio"]'),h("checkbox",'input[type="checkbox"]'),f},A=function(a){var b={},c=a.input,d=c.$().closest(".frm-group");return b.get=c.get||function(){},b.set=c.set||function(){},b.disable=c.disable,b.enable=c.enable,b.getType=c.getType,b.$=function(a){return a?d.find(a):d},function(){var a=null,c=!1;b.setFeedback=function(d){c||b.$().addClass("error"),d!==a&&b.$(".frm-feedback").html(d),a=d,c=!0},b.clearFeedback=function(){c&&(b.$().removeClass("error"),b.$(".frm-feedback").html("")),a=null,c=!1}}(),b},B=function(a){var c=n(),f=a.$,g=f.find(".frm-global-feedback"),l=a.ajax,o=a.url||f.attr("action"),p=a.inputs;return function(){var a=!1,b=null;c.setGlobalFeedback=function(d){c.clearGlobalSuccess(),a||f.addClass("error"),d!==b&&g.html(d),a=!0,b=d},c.clearGlobalFeedback=function(){a&&f.removeClass("error"),b&&g.html(""),a=!1,b=null}}(),function(){var a=!1,b=null;c.setGlobalSuccess=function(d){c.clearGlobalFeedback(),a||f.addClass("success"),d!==b&&g.html(d),a=!0,b=d},c.clearGlobalSuccess=function(){a&&f.removeClass("success"),b&&g.html(""),a=!1,b=null}}(),c.setFeedback=function(a){e(m(p,j(a)),function(b,c){b.setFeedback(a[c])}),c.setGlobalFeedback(a.GLOBAL)},c.clearFeedback=function(){i(p,"clearFeedback"),c.clearGlobalFeedback()},c.disable=function(){i(p,"disable")},c.enable=function(){i(p,"enable")},c.validate=a.validate||function(){return{}},c.get=function(){return h(k(p,function(a){return!d(["file","button"],a.getType())}),function(a){return a.get()})},f.submit(function(a){a.preventDefault();var d=c.get(),e=c.validate(d);c.clearFeedback(),b(e)?l({url:o,method:"POST",data:d,dataType:"json",beforeSend:function(){c.disable(),c.publish("beforeSend")},success:function(a){c.setGlobalSuccess(a.successMessage),c.publish("success",a)},error:function(a){409===a.status&&(c.setFeedback(a.responseJSON),c.publish("error",a.responseJSON))},complete:function(){c.enable(),c.publish("complete")}}):(c.setFeedback(e),c.publish("error",e))}),c},C={};C.init=function(a){var b=a.$,c=a.url,d=o({$:b,url:c}),e=d.form({validate:a.validate});return e},window.forminator=C}();