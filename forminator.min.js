// forminator version 0.0.0
// https://github.com/DubFriend/forminator
// (MIT) 28-02-2014
// Brian Detering <BDeterin@gmail.com> (http://www.briandetering.net/)
!function(){"use strict";!function(a){var b,c=function(b){return a.isArray(b)},d=function(a){return!c(a)&&a instanceof Object},e=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)},f=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,b.concat(c))}},g=function(){var a,b={};for(a=0;a<arguments.length;a+=1)e(arguments[a],function(a,c){b[c]=a});return b},h=function(a,b){var d;return c(a)?(d=[],e(a,function(a,c,e){b(a,c,e)&&d.push(a)})):(d={},e(a,function(a,c,e){b(a,c,e)&&(d[c]=a)})),d},i=function(b,c){return a.inArray(c,b)},j=function(a,b){return h(a,function(a,c){return-1===i(b,c)})},k=function(a,b){return function(){(b||function(){}).apply(a,arguments)}},l=function(a){return/\[\]$/.test(a)},m=function(a,b){return a.substring(0,a.length-1)+b+"]"},n=function(b){var c={};return b.each(function(){var b=a(this).attr("name");b&&(c[b]||(c[b]=[]),c[b].push(a(this)))}),c},o=function(){return b.find('input[type="checkbox"], input[type="radio"], input[type="text"], input[type="hidden"], textarea, select')},p=function(a){var b=function(a){var b={};return e(a,function(a,f){!function g(a,f){d(f)||c(f)?e(f,function(b,c){g(a+"["+c+"]",b)}):b[a]=f}(f,a)}),b},f=function(){var a=n(o()),b={},c=function(a,c){var d=function(){return a.is('input[type="checkbox"]')||a.is('input[type="radio"]')},e=function(){return a.is("textarea")?a.html():d()?a.is(":checked")?a.val():void 0:a.val()},f=e();(d()&&f||!d())&&(b[c]=f)};return e(a,function(a,b){l(b)?e(a,function(a,d){c(a,m(b,d))}):a.length>1?e(a,function(a){c(a,b)}):c(a[0],b)}),b};return a?b(a()):f()},q=function(b){if(b){var c=b.match(/#@#.*#@#/gim);return c&&c[0]?(c=c[0].substring(3,c[0].length-3),c=a.parseJSON(c)):null}return null},r=function(a){return a?a.replace(/#@#.*#@#/gim,""):null},s=function(c){var d=function(){var a=function(a,b){return l(a)?m(a,b):a},c=n(b.find('input[type="file"]')),d={};return e(c,function(b,c){e(b,function(b,e){d[a(c,e)]=b})}),d};b.submit(function(b){if(console.log("ajax2"),b.preventDefault(),!c.validate||c.validate()){var f=new FormData;e(p(),function(a,b){f.append(b,a)}),e(d(),function(a,b){var c=a[0];c.files.length>0&&(0===c.files.length?f.append(b,c.files[0]):e(c.files,function(a,c){f.append(b+"["+c+"]",a)}))}),a.ajax(j(g(c,{processData:!1,contentType:!1,data:null,dataType:"text",beforeSend:function(a,b){b.xhr=function(){var a=new window.XMLHttpRequest;return a.upload.onprogress=k(this,c.onprogress),a.upload.onload=k(this,c.onload),a.upload.onerror=k(this,c.onerror),a.upload.onabort=k(this,c.onabort),a},b.data=f,c.beforeSend&&c.beforeSend()},success:function(b){var d=q(b);b=r(b),"json"===c.dataType.toLowerCase()&&(b=a.parseJSON(b));var e=d&&d.status||b.status;!e||e>=200&&300>e?c.success&&c.success(b,d):c.error&&c.error(b,d)},error:function(b){var d=q(b.responseText),e=r(b.responseText);"json"===c.dataType.toLowerCase()&&(e=a.parseJSON(e)),c.error&&c.error(e,d)},complete:function(){c.complete&&c.complete()}})),["$files","getData"])}})},t=function(c){b.submit(function(d){if(console.log("iframeAjax"),d.stopPropagation(),!c.validate||c.validate()){var f="file-ajax-id-"+(new Date).getTime();a("body").prepend('<iframe width="0" height="0" style="display:none;" name="'+f+'" id="'+f+'"/>');var g={};o().each(function(){var b=a(this).attr("name");b&&(g[b]=a(this))});var h=function(){e(g,function(a){a.removeAttr("name")})},i=function(){e(g,function(a,b){a.attr("name",b)})},j=a("#"+f);j.on("load",function(){var b=j.contents().find("body").html(),d=q(b),e=r(b);e=c.dataType&&"json"===c.dataType.toLowerCase()?a.parseJSON(e):e;var f=d&&d.status||e.status;!f||f>=200&&300>f?c.success&&c.success(e,d):c.error&&c.error(e,d),i(),m(),j.remove(),c.complete&&c.complete()});var k=p();h();var l=[];e(k,function(c,d){var e=a('<input type="hidden" name="'+d+'" value="'+c+'"/>');b.append(e),l.push(e)});var m=function(){e(l,function(a){a.remove()})};b.attr({target:f,action:c.url,method:"POST",enctype:"multipart/form-data"})}else d.preventDefault()})};a.fn.fileAjax=function(c){if(b=a(this),!b.is("form"))throw"selected element must be a form element";c.type="POST",c.url=c.url||b.attr("action"),p=f(p,c.getData),a.support.ajax&&"undefined"!=typeof FormData&&c.forceIFrame!==!0?s(c):t(c)}}(jQuery);{var a=function(a){return $.isArray(a)},b=function(b){return!a(b)&&b instanceof Object},c=function(a){return a instanceof Function},d=function(a){var b=Array.prototype.slice.call(arguments,1);return c(a)?function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,b.concat(c))}:void 0},e=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},f=function(a,b){return $.inArray(b,a)},g=function(a,b){return-1!==f(a,b)},h=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)},i=function(a){return a[a.length-1]},j=function(a,b){var c=[];return h(a,function(a,d,e){c.push(b(a,d,e))}),c},k=function(a,b,c){var d={};return h(a,function(a,e,f){e=c?c(e,a):e,d[e]=b(a,e,f)}),d},l=function(b,c,d){return a(b)?j(b,c):k(b,c,d)},m=function(a,b,c){h(a,function(a){a[b].apply(a,c||[])})},n=function(a){return j(a,function(a,b){return b})},o=function(b,c){var d;return a(b)?(d=[],h(b,function(a,b,e){c(a,b,e)&&d.push(a)})):(d={},h(b,function(a,b,e){c(a,b,e)&&(d[b]=a)})),d},p=function(){var a,b={};for(a=0;a<arguments.length;a+=1)h(arguments[a],function(a,c){b[c]=a});return b},q=function(a,b){return o(a,function(a,c){return-1!==f(b,c)})},r=function(a){return c(a)?a():void 0},s=(function(){var a=0;return function(){return a+=1}}(),function(a){a=a||{};var b={};return a.publish=function(a,c){h(b[a],function(a){a(c)})},a.subscribe=function(a,c){b[a]=b[a]||[],b[a].push(c)},a.unsubscribe=function(a){h(b,function(b){var c=f(b,a);-1!==c&&b.splice(c,1)})},a});!function(){var a={},b=function(a){var b,c,d,e="",g="",h=function(){var b=-1!==f(a,"#"),c=-1!==f(a,"?"),d="";return c&&(d=a.split("?")[1]||"",b&&(d=d.split("#")[0]||"")),e=c?a.split("?")[0]||"":b?a.split("#")[0]||"":a,b&&(g=a.split("#")[1]||""),d?d.split("&"):[]},i=h(a),j={};for(d=0;d<i.length;d+=1)b=i[d].split("=")[0],c=i[d].split("=")[1],j[b]=c;return{url:e||"",hash:g||"",parameters:j}},c=function(a){var b=[];return h(a.parameters,function(c,d){b.push(d+"="+a.parameters[d])}),a.url+(b.length>0?"?"+b.join("&"):"")+(a.hash?"#"+a.hash:"")};return a.get=function(a){return b(a).parameters},a.set=function(a,d){var e=b(a);return e.parameters=p(e.parameters,d),c(e)},a}()}"undefined"==typeof console&&(console={},console.warn=function(){});var t=function(a){var b={},c=a.url,d=a.$;return b.input={text:C,textarea:D,select:B,radio:A,checkbox:y,file:z,button:x,hidden:E},b.form=function(){return H({$:d,ajax:u,validate:a.validate,onprogress:a.onprogress,success:a.success,error:a.error,complete:a.complete,url:c,inputs:l(F({$:d,factory:b}),function(a){return G({input:a})})})},b},u=function(a,c){if(a.find('input[type="file"]').length){a.fileAjax(c)}else a.submit(function(a){console.log("asdf",r(c.getData)),a.preventDefault(),c.validate()&&$.ajax({url:c.url,method:"POST",data:r(c.getData),dataType:c.dataType,beforeSend:c.beforeSend,success:function(a){b(a)&&(a.status<200||a.status>=300)?c.error&&c.error(a):c.success(a)},error:function(a){if(console.log(a),c.error){{c.dataType?c.dataType.toLowerCase():null}c.error(a.responseJSON)}},complete:c.complete})})},v=function(a){var b=s(),c=a.$;return b.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},b.$=function(a){return a?c.find(a):c},b.disable=function(){b.$().prop("disabled",!0),b.publish("isEnabled",!1)},b.enable=function(){b.$().prop("disabled",!1),b.publish("isEnabled",!0)},b},w=function(a,b){var c=v(a,b);return c.get=function(){return c.$().val()},c.set=function(a){var b=c.get();b!==a&&(c.$().val(a),c.publish("change",a))},b.buildSetter=function(a){return function(b){var d=c.get();d!==b&&(a.call(c,b),c.publish("change",b))}},c},x=function(a){var b={},c=w(a,b);return c.getType=function(){return"button"},c},y=function(a){var b={},c=w(a,b);return c.getType=function(){return"checkbox"},c.get=function(){var a=[];return c.$().filter(":checked").each(function(){$(this).is(":checked")&&a.push($(this).val())}),a},c.set=function(a){a=a||[];var b=c.get(),d=!1;b.length===a.length?h(b,function(b){-1===f(a,b)&&(d=!0)}):d=!0,d&&(c.$().each(function(){$(this).prop("checked",!1)}),h(a,function(a){c.$().filter('[value="'+a+'"]').prop("checked",!0)}),c.publish("change",a))},c.$().click(function(){c.publish("change",c.get())}),c},z=function(a){var b={},c=v(a,b);return c.getType=function(){return"file"},c.get=function(){return i(c.$().val().split("\\"))},c.$().change(function(){c.publish("change",c.get())}),c},A=function(a){var b={},c=w(a,b);return c.getType=function(){return"radio"},c.get=function(){return c.$().filter(":checked").val()},c.set=b.buildSetter(function(a){c.$().filter('[value="'+a+'"]').prop("checked",!0)}),c.$().change(function(){c.publish("change",c.get())}),c},B=function(a){var b={},c=w(a,b);return c.getType=function(){return"select"},c.$().change(function(){c.publish("change",c.get())}),c},C=function(a){var b={},c=w(a,b);return c.getType=function(){return"text"},c.$().keyup(function(){c.publish("change",c.get())}),c},D=function(a){var b={},c=w(a,b);return c.getType=function(){return"textarea"},c.get=function(){return c.$().val()},c.set=b.buildSetter(function(a){this.$().text(a)}),c.$().keyup(function(){c.publish("change",c.get())}),c},E=function(a){var b={},c=w(a,b);return c.getType=function(){return"hidden"},c.$().keyup(function(){c.publish("change",c.get())}),c},F=function(a){var b=a.$,c=a.factory,d={},e=function(a,e,f){f=f||d,b.find(e).each(function(){f[$(this).attr("name")]=c.input[a]({$:$(this)})})};e("text",'input[type="text"]'),e("textarea","textarea"),e("select","select"),e("file",'input[type="file"]'),e("button",'input[type="button"], input[type="submit"]'),e("hidden",'input[type="hidden"]');var g=function(a,e){var g=[];b.find(e).each(function(){-1===f(g,$(this).attr("name"))&&g.push($(this).attr("name"))}),h(g,function(e){d[e]=c.input[a]({$:b.find('input[name="'+e+'"]')})})};return g("radio",'input[type="radio"]'),g("checkbox",'input[type="checkbox"]'),d},G=function(a){var b={},c=a.input,d=c.$().closest(".frm-group");return b.get=c.get||function(){},b.set=c.set||function(){},b.disable=c.disable,b.enable=c.enable,b.getType=c.getType,b.$=function(a){return a?d.find(a):d},function(){var a=null,c=!1;b.setFeedback=function(d){c||b.$().addClass("error"),d!==a&&b.$(".frm-feedback").html(d),a=d,c=!0},b.clearFeedback=function(){c&&(b.$().removeClass("error"),b.$(".frm-feedback").html("")),a=null,c=!1}}(),b},H=function(a){var b=s(),c=a.$,f=c.find(".frm-global-feedback"),i=a.ajax,j=a.url||c.attr("action"),k=a.inputs;return function(){var a=!1,d=null;b.setGlobalFeedback=function(e){b.clearGlobalSuccess(),a||c.addClass("error"),e!==d&&f.html(e),a=!0,d=e},b.clearGlobalFeedback=function(){a&&c.removeClass("error"),d&&f.html(""),a=!1,d=null}}(),function(){var a=!1,d=null;b.setGlobalSuccess=function(e){b.clearFeedback(),a||c.addClass("success"),e!==d&&f.html(e),a=!0,d=e},b.clearGlobalSuccess=function(){a&&c.removeClass("success"),d&&f.html(""),a=!1,d=null}}(),b.setFeedback=function(a){a=a||{},b.clearFeedback(),h(q(k,n(a)),function(b,c){b.setFeedback(a[c])}),b.setGlobalFeedback(a.GLOBAL)},b.clearFeedback=function(){m(k,"clearFeedback"),b.clearGlobalFeedback()},b.disable=function(){m(k,"disable")},b.enable=function(){m(k,"enable")},b.validate=a.validate||function(){return{}},b.get=function(){return l(o(k,function(a){return!g(["file","button"],a.getType())}),function(a){return a.get()})},i(c,{url:j,dataType:"json",getData:b.get,validate:function(){var a=b.validate(b.get());return e(a)?!0:(b.setFeedback(a),b.publish("error",a),!1)},onprogress:function(b){r(d(a.onprogress,b)),console.log(b.loaded,b.total)},beforeSend:function(){r(a.beforeSend),b.disable(),b.publish("beforeSend")},success:function(c){r(d(a.success,c)),c=c||{},b.setGlobalSuccess(c.successMessage),b.publish("success",c)},error:function(c){r(d(a.error,c)),b.setFeedback(c),b.publish("error",c)},complete:function(){r(a.complete),b.enable(),b.publish("complete")}}),b},I={};I.init=function(a){var b=t(a),c=b.form();return c},window.forminator=I}();