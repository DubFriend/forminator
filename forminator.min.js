// forminator version 0.0.0
// https://github.com/DubFriend/forminator
// (MIT) 07-03-2014
// Brian Detering <BDeterin@gmail.com> (http://www.briandetering.net/)
!function(){"use strict";!function(a){var b,c=function(b){return a.isArray(b)},d=function(a){return!c(a)&&a instanceof Object},e=function(a){return a instanceof Function},f=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)},g=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,b.concat(c))}},h=function(){var a,b={};for(a=0;a<arguments.length;a+=1)f(arguments[a],function(a,c){b[c]=a});return b},i=function(a,b){var d;return c(a)?(d=[],f(a,function(a,c,e){b(a,c,e)&&d.push(a)})):(d={},f(a,function(a,c,e){b(a,c,e)&&(d[c]=a)})),d},j=function(b,c){return a.inArray(c,b)},k=function(a,b){return i(a,function(a,c){return-1===j(b,c)})},l=function(a,b){return function(){(b||function(){}).apply(a,arguments)}},m=function(a){return/\[\]$/.test(a)},n=function(a,b){return a.substring(0,a.length-1)+b+"]"},o=function(b){var c={};return b.each(function(){var b=a(this).attr("name");b&&(c[b]||(c[b]=[]),c[b].push(a(this)))}),c},p=function(){return b.find('input[type="checkbox"], input[type="radio"], input[type="text"], input[type="hidden"], textarea, select')},q=function(a){var b=function(a){var b={};return f(a,function(a,e){!function g(a,e){d(e)||c(e)?f(e,function(b,c){g(a+"["+c+"]",b)}):b[a]=e}(e,a)}),b},e=function(){var a=o(p()),b={},c=function(a,c){var d=function(){return a.is('input[type="checkbox"]')||a.is('input[type="radio"]')},e=function(){return a.is("textarea")?a.html():d()?a.is(":checked")?a.val():void 0:a.val()},f=e();(d()&&f||!d())&&(b[c]=f)};return f(a,function(a,b){m(b)?f(a,function(a,d){c(a,n(b,d))}):a.length>1?f(a,function(a){c(a,b)}):c(a[0],b)}),b};return a?b(a()):e()},r=function(b){if(b){var c=b.match(/#@#.*#@#/gim);return c&&c[0]?(c=c[0].substring(3,c[0].length-3),c=a.parseJSON(c)):null}return null},s=function(a){return a?a.replace(/#@#.*#@#/gim,""):null},t=function(a,b){b.is('input[type="text"]')||b.is("select")||b.is('input[type="hidden"]')||b.is("textarea")?b.val(a):(b.is('input[type="checkbox"]')||b.is('input[type="radio"]'))&&(""===a||null===a?b.prop("checked",!1):b.filter('[value="'+a+'"]').prop("checked",!0))},u=function(c){c=c||b,c.find('input[type="file"]').each(function(){a(this).wrap("<form>").closest("form").get(0).reset(),a(this).unwrap()})},v=function(c){c=c||!1,p().not('input[type="hidden"]').each(function(){t("",a(this))}),c&&b.find('input[type="hidden"]').each(function(){t("",a(this))}),u()},w=function(a){return e(a)?a.apply({clear:v,clearFileInputs:u,set:function(a,c){t(c,b.find('[name="'+a+'"]'))},get:q},Array.prototype.slice.call(arguments,1)):void 0},x=function(a,b,c){var d=a.response,e=a.metaData,f=e&&e.status||d&&d.status||200;!f||f>=200&&300>f?w(b,d,e):w(c,d,e)},y=function(b,c){var d=r(b);return b=s(b),"json"===c.toLowerCase()&&(b=a.parseJSON(b)),{metaData:d,response:b}},z=function(c){var d=function(){var a=function(a,b){return m(a)?n(a,b):a},c=o(b.find('input[type="file"]'));console.log(c);var d={};return f(c,function(b,c){f(b,function(b,e){d[a(c,e)]=b})}),d};b.submit(function(b){if(console.log("ajax2"),b.preventDefault(),!c.validate||c.validate()){var e=new FormData;f(q(),function(a,b){e.append(b,a)}),f(d(),function(a,b){var c=a[0];c.files.length>0&&(0===c.files.length?e.append(b,c.files[0]):f(c.files,function(a,c){console.log(a),e.append(b+"["+c+"]",a)}))}),a.ajax(k(h(c,{processData:!1,contentType:!1,data:null,type:"POST",dataType:"text",beforeSend:function(a,b){b.xhr=function(){var a=new window.XMLHttpRequest;return a.upload.onprogress=l(this,c.onprogress),a.upload.onload=l(this,c.onload),a.upload.onerror=l(this,c.onerror),a.upload.onabort=l(this,c.onabort),a},b.data=e,w(c.beforeSend)},success:function(a){var b=y(a,c.dataType);x(b,c.success,c.error)},error:function(a){var b=y(a.responseText,c.dataType);w(c.error,b.response,b.metaData)},complete:function(a){var b=y(a.responseText,c.dataType);w(c.complete,b.response,b.metaData)}})),["$files","getData"])}})},A=function(c){b.submit(function(d){if(console.log("iframeAjax"),d.stopPropagation(),!c.validate||c.validate()){var e="file-ajax-id-"+(new Date).getTime();a("body").prepend('<iframe width="0" height="0" style="display:none;" name="'+e+'" id="'+e+'"/>');var g={};p().each(function(){var b=a(this).attr("name");b&&(g[b]=a(this))});var h=function(){f(g,function(a){a.removeAttr("name")})},i=function(){f(g,function(a,b){a.attr("name",b)})},j=a("#"+e);j.on("load",function(){var a=j.contents().find("body").html(),b=y(a,c.dataType);x(b,c.success,c.error),i(),m(),j.remove(),w(c.complete,b.response,b.metaData)});var k=q();h();var l=[];f(k,function(c,d){var e=a('<input type="hidden" name="'+d+'" value="'+c+'"/>');b.append(e),l.push(e)});var m=function(){f(l,function(a){a.remove()})};b.attr({target:e,action:c.url,method:"POST",enctype:"multipart/form-data"})}else d.preventDefault()})},B=function(c){if(b=a(this),!b.is("form"))throw"selected element must be a form element";c.url=c.url||b.attr("action"),q=g(q,c.getData),a.support.ajax&&"undefined"!=typeof FormData&&c.forceIFrame!==!0?z(c):A(c)};B.clearFileInputs=u,a.fn.fileAjax=B,a.fileAjax=B}(jQuery);var a=function(a){return $.isArray(a)},b=function(b){return!a(b)&&b instanceof Object},c=function(a){return a instanceof Function},d=function(a){var b=Array.prototype.slice.call(arguments,1);return c(a)?function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,b.concat(c))}:void 0},e=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b]);return c},f=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},g=function(a,b){return $.inArray(b,a)},h=function(a,b){return-1!==g(a,b)},i=function(a){return $.extend(!0,{},a)},j=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)},k=function(a){return a[a.length-1]},l=function(a,b){var c=[];return j(a,function(a,d,e){c.push(b(a,d,e))}),c},m=function(a,b,c){var d={};return j(a,function(a,e,f){e=c?c(e,a):e,d[e]=b(a,e,f)}),d},n=function(b,c,d){return a(b)?l(b,c):m(b,c,d)},o=function(a,b,c){return n(a,function(a){return a[b].apply(a,c||[])})},p=function(a){return l(a,function(a,b){return b})},q=function(b,c){var d;return a(b)?(d=[],j(b,function(a,b,e){c(a,b,e)&&d.push(a)})):(d={},j(b,function(a,b,e){c(a,b,e)&&(d[b]=a)})),d},r=function(){var a,b={};for(a=0;a<arguments.length;a+=1)j(arguments[a],function(a,c){b[c]=a});return b},s=function(a,b){return q(a,function(a,c){return-1!==g(b,c)})},t=function(a){var b=Array.prototype.slice.call(arguments,1);return c(a)?a.apply(null,b):void 0},u=(function(){var a=0;return function(){return a+=1}}(),function(a){a=a||{};var b={};return a.publish=function(a,c){j(b[a],function(a){a(c)})},a.subscribe=function(a,c){b[a]=b[a]||[],b[a].push(c)},a.unsubscribe=function(a){j(b,function(b){var c=g(b,a);-1!==c&&b.splice(c,1)})},a}),v=(function(){var a={},b=function(a){var b,c,d,e="",f="",h=function(){var b=-1!==g(a,"#"),c=-1!==g(a,"?"),d="";return c&&(d=a.split("?")[1]||"",b&&(d=d.split("#")[0]||"")),e=c?a.split("?")[0]||"":b?a.split("#")[0]||"":a,b&&(f=a.split("#")[1]||""),d?d.split("&"):[]},i=h(a),j={};for(d=0;d<i.length;d+=1)b=i[d].split("=")[0],c=i[d].split("=")[1],j[b]=c;return{url:e||"",hash:f||"",parameters:j}},c=function(a){var b=[];return j(a.parameters,function(c,d){b.push(d+"="+a.parameters[d])}),a.url+(b.length>0?"?"+b.join("&"):"")+(a.hash?"#"+a.hash:"")};return a.get=function(a){return b(a).parameters},a.set=function(a,d){var e=b(a);return e.parameters=r(e.parameters,d),c(e)},a}(),function(a,b,c){return $("#frm"+(c?"-"+c:"")+(b?"-"+b:""))}),w=d(v,"#frm"),x=(d(v,".frm"),function(a){var b={},c=a.url,e=a.name,f=d(w,e),g=function(a,b){return function(){var c=f(b);return c.length?a(c):void 0}};return b.input={text:G,textarea:H,select:F,radio:E,checkbox:C,file:D,button:B,hidden:I},b.form=g(function(d){return L({$:d,ajax:y,validate:a.validate,onprogress:a.onprogress,success:a.success,error:a.error,complete:a.complete,url:c,inputs:n(J({$:d,factory:b}),function(a){return K({input:a})})})}),b.list=g(function(a){return N({$:a})},"list"),b}),y=function(a,c){if(c.type=c.type||"POST",c.dataType=c.dataType.toLowerCase()||"json",a.find('input[type="file"]').length){console.log("$.fn.fileAjax");a.fileAjax(c)}else console.log("$.ajax"),a.submit(function(a){a.preventDefault(),c.validate()&&$.ajax({url:c.url,type:c.type,data:t(c.getData),dataType:c.dataType,beforeSend:c.beforeSend,success:function(a){b(a)&&(a.status<200||a.status>=300)?t(c.error,a):t(c.success,a)},error:function(a){t(c.error,"json"===c.dataType?a.responseJSON:a.responseText)},complete:function(a){t(c.complete,"json"===c.dataType?a.responseJSON:a.responseText)}})})},z=function(a){var b=u(),c=a.$;return b.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},b.$=function(a){return a?c.find(a):c},b.disable=function(){b.$().prop("disabled",!0),b.publish("isEnabled",!1)},b.enable=function(){b.$().prop("disabled",!1),b.publish("isEnabled",!0)},b},A=function(a,b){var c=z(a,b);return c.get=function(){return c.$().val()},c.set=function(a){var b=c.get();b!==a&&(c.$().val(a),c.publish("change",a))},c.clear=function(){c.set("")},b.buildSetter=function(a){return function(b){var d=c.get();d!==b&&(a.call(c,b),c.publish("change",b))}},c},B=function(a){var b={},c=A(a,b);return c.getType=function(){return"button"},c},C=function(b){var c={},d=A(b,c);return d.getType=function(){return"checkbox"},d.get=function(){var a=[];return d.$().filter(":checked").each(function(){$(this).is(":checked")&&a.push($(this).val())}),a},d.set=function(b){b=b||[],a(b)||(b=[b]);var c=d.get(),e=!1;c.length===b.length?j(c,function(a){-1===g(b,a)&&(e=!0)}):e=!0,e&&(d.$().each(function(){$(this).prop("checked",!1)}),j(b,function(a){d.$().filter('[value="'+a+'"]').prop("checked",!0)}),d.publish("change",b))},d.$().click(function(){d.publish("change",d.get())}),d},D=function(a){var b={},c=z(a,b);return c.getType=function(){return"file"},c.get=function(){return k(c.$().val().split("\\"))},c.clear=function(){$.fileAjax.clearFileInputs(c.$().parent())},c.$().change(function(){c.publish("change",c.get())}),c},E=function(a){var b={},c=A(a,b);return c.getType=function(){return"radio"},c.get=function(){return c.$().filter(":checked").val()||null},c.set=b.buildSetter(function(a){a?c.$().filter('[value="'+a+'"]').prop("checked",!0):c.$().prop("checked",!1)}),c.$().change(function(){c.publish("change",c.get())}),c},F=function(a){var b={},c=A(a,b);return c.getType=function(){return"select"},c.$().change(function(){c.publish("change",c.get())}),c},G=function(a){var b={},c=A(a,b);return c.getType=function(){return"text"},c.$().keyup(function(){c.publish("change",c.get())}),c},H=function(a){var b={},c=A(a,b);return c.getType=function(){return"textarea"},c.$().keyup(function(){c.publish("change",c.get())}),c},I=function(a){var b={},c=A(a,b);return c.getType=function(){return"hidden"},c.$().keyup(function(){c.publish("change",c.get())}),c},J=function(a){var b=a.$,c=a.factory,d={},e=function(a,e,f){f=f||d,b.find(e).each(function(){f[$(this).attr("name")]=c.input[a]({$:$(this)})})};e("text",'input[type="text"]'),e("textarea","textarea"),e("select","select"),e("file",'input[type="file"]'),e("button",'input[type="button"], input[type="submit"]'),e("hidden",'input[type="hidden"]');var f=function(a,e){var f=[];b.find(e).each(function(){-1===g(f,$(this).attr("name"))&&f.push($(this).attr("name"))}),j(f,function(e){d[e]=c.input[a]({$:b.find('input[name="'+e+'"]')})})};return f("radio",'input[type="radio"]'),f("checkbox",'input[type="checkbox"]'),d},K=function(a){var b={},c=a.input,d=c.$().closest(".frm-group");return b.get=c.get||function(){},b.set=c.set||function(){},b.clear=c.clear||function(){},b.disable=c.disable,b.enable=c.enable,b.getType=c.getType,b.$=function(a){return a?d.find(a):d},function(){var a=null,c=!1;b.setFeedback=function(d){c||b.$().addClass("error"),d!==a&&b.$(".frm-feedback").html(d),a=d,c=!0},b.clearFeedback=function(){c&&(b.$().removeClass("error"),b.$(".frm-feedback").html("")),a=null,c=!1}}(),b},L=function(a){var c=u(),g=a.$,i=g.find(".frm-global-feedback"),k=a.ajax,l=a.url||g.attr("action"),m=a.inputs;!function(){var a=!1,b=null;c.setGlobalFeedback=function(d){c.clearGlobalSuccess(),a||g.addClass("error"),d!==b&&i.html(d),a=!0,b=d},c.clearGlobalError=function(){a&&g.removeClass("error"),b&&i.html(""),a=!1,b=null}}(),function(){var a=!1,b=null;c.setGlobalSuccess=function(d){c.clearFeedback(),a||g.addClass("success"),d!==b&&i.html(d),a=!0,b=d},c.clearGlobalSuccess=function(){a&&g.removeClass("success"),b&&i.html(""),a=!1,b=null}}(),c.clearGlobalFeedback=function(){c.clearGlobalError(),c.clearGlobalSuccess()},c.setFeedback=function(a){a=a||{},c.clearFeedback(),j(s(m,p(a)),function(b,c){b.setFeedback(a[c])}),c.setGlobalFeedback(a.GLOBAL)},c.clearFeedback=function(){o(m,"clearFeedback"),c.clearGlobalFeedback()},c.disable=function(){o(m,"disable")},c.enable=function(){o(m,"enable")},c.validate=a.validate||function(){return{}};var n=function(){var a=e(arguments);return q(m,function(b){return!h(a,b.getType())})};return c.get=function(){return o(n("file","button"),"get")},c.set=function(a,d){b(a)?j(a,function(a,b){c.set(b,a)}):m[a]&&m[a].set(d)},c.clear=function(a){a=a||{};var b=a.isClearHidden?["button"]:["button","hidden"];o(n.apply(null,b),"clear")},k(g,{url:l,dataType:"json",getData:c.get,validate:function(){var a=c.validate(c.get());return f(a)?!0:(c.setFeedback(a),c.publish("error",a),!1)},onprogress:function(b){t(d(a.onprogress,b)),console.log(b.loaded,b.total)},beforeSend:function(){t(a.beforeSend),c.disable(),c.publish("beforeSend")},success:function(b){t(d(a.success,b)),b=b||{},c.setGlobalSuccess(b.successMessage),c.publish("success",b)},error:function(b){t(d(a.error,b)),c.setFeedback(b),c.publish("error",b)},complete:function(b){t(a.complete,b),c.enable(),c.publish("complete",b)}}),c},M=function(a){var b=u(),c=a.$self,d=function(a){j(a,function(a,b){c.find('[data-field="'+b+'"]').html(a)})},e=function(){var a={};return c.find("[data-field]").each(function(){a[$(this).attr("data-field")]=$(this).html()}),a},f=e();return b.set=function(a){var c=q(a,function(a,b){return"undefined"==typeof f[b]?!1:f[b]!==a});return f=r(f,c),d(c),b},b.hardSet=function(a){b.clear(),b.set(a)},b.clear=function(){return c.find("[data-field]").html(""),f=n(f,function(){return""}),b},b.destroy=function(){c.remove()},b.get=function(){return i(f)},function(){var a=!1;b.addSelectedClass=function(){a||c.addClass("selected"),a=!0},b.removeSelectedClass=function(){a&&c.removeClass("selected"),a=!1}}(),c.dblclick(function(){b.publish("selected",b)}),b},N=function(a){var b=u(),c=a.$,d=function(){var a=c.find(".frm-list-item:first-child").clone(),b=M({$self:a});return b.clear(),a}(),e=function(a){return a.subscribe("selected",function(){o(f,"removeSelectedClass"),a.addSelectedClass(),b.publish("selected",a)}),a},f=function(){var a=[];return c.find(".frm-list-item").each(function(){a.push(e(M({$self:$(this)})))}),a}();return b.set=function(a){var b=[];j(a,function(a,c){var g;f[c]?f[c].hardSet(a):(g=d.clone(),b.push(g),f[c]=e(M({$self:g})),f[c].set(a))}),c.append(b),f.length>a.length&&o(f.splice(a.length,f.length-a.length),"destroy")},b},O={};O.init=function(a){var b=x(a),c=b.form(),d=b.list(),e=a.fieldMap||{};return d&&c&&d.subscribe("selected",function(a){c.set(n(a.get(),function(a,b){return console.log(a,b),t(e[b],a)||a}))}),{form:c,list:d}},window.forminator=O}();